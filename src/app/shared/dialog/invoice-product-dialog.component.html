<div class="loading" *ngIf="showLoading" >
    <img class="loading-image" id="loading8" src="/assets/image/loading-08.png" />
    <img class="loading-image" id="loading7" src="/assets/image/loading-07.png" />
    <img class="loading-image" id="loading6" src="/assets/image/loading-06.png" />
    <img class="loading-image" id="loading5" src="/assets/image/loading-05.png" />
    <img class="loading-image" id="loading4" src="/assets/image/loading-04.png" />
    <img class="loading-image" id="loading3" src="/assets/image/loading-03.png" />
    <img class="loading-image" id="loading2" src="/assets/image/loading-02.png" />
    <img class="loading-image" id="loading1" src="/assets/image/loading-01.png" />
</div>

<div class="container" *ngIf="!showLoading" >

    <h1 *ngIf="action == 'create'" mat-dialog-title class="container-h1">AGREGAR PRODUCTO</h1>
    <h1 *ngIf="action == 'edit'" mat-dialog-title class="container-h1">EDITAR PRODUCTO</h1>
    <h1 *ngIf="action == 'delete'" mat-dialog-title class="container-h1">BORRAR PRODUCTO</h1>
    <h1 *ngIf="action == 'cancel'" mat-dialog-title class="container-h1">CANCELAR FACTURA</h1>

    <button mat-button class="container-button" (click)="closeDialog()">X</button>

    <form *ngIf="action != 'cancel'" style="margin: 24px 0 16px 0;"
        [formGroup]="productForm"
        novalidate
        (ngSubmit)="onSubmitInvoiceProductForm(productForm.value)"
    >
        
        <div class="row">

            <div *ngIf="action != 'delete'" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <mat-form-field floatLabel="auto" style="width: 100%;" >
                    <mat-label>CATEGORÍA</mat-label> 
                    <mat-select
                    floatPlaceholder="never"
                    formControlName="categoryId"
                    (selectionChange)="onSelectChangeProductCategories($event.value)"
                    >
                    <mat-option
                        *ngFor="let item of productCategories"
                        [value]="item.id"
                    >
                        {{ item.name }}
                    </mat-option>
                    </mat-select>
                    <mat-error *ngFor="let validation of productValidationMessages.categoryId">
                        <mat-error
                            class="error-message"
                            *ngIf="
                            productForm.get('categoryId').hasError(validation.type) &&
                            (productForm.get('categoryId').dirty ||
                            productForm.get('categoryId').touched)
                            "
                            >{{ validation.message }}
                        </mat-error>
                    </mat-error>
                </mat-form-field>
            </div>
            <div *ngIf="action != 'delete'" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <mat-form-field floatLabel="auto" style="width: 100%;" >
                    <mat-label>PRODUCTO</mat-label> 
                    <mat-select
                    floatPlaceholder="never"
                    formControlName="id"
                    >
                    <mat-option
                        *ngFor="let item of products"
                        [value]="item.id"
                    >
                        {{ item.name }}
                    </mat-option>
                    </mat-select>
                    <mat-error *ngFor="let validation of productValidationMessages.id">
                        <mat-error
                            class="error-message"
                            *ngIf="
                            productForm.get('id').hasError(validation.type) &&
                            (productForm.get('id').dirty ||
                            productForm.get('id').touched)
                            "
                            >{{ validation.message }}
                        </mat-error>
                    </mat-error>
                </mat-form-field>
            </div>
            <div *ngIf="action == 'delete'" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <mat-form-field floatLabel="auto" style="width: 100%;" >
                    <mat-label>CATEGORÍA</mat-label> 
                    <input matInput type="text" [value]="product.categoryName" name="categoryName" readonly />
                </mat-form-field>
            </div>
            <div *ngIf="action == 'delete'" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <mat-form-field floatLabel="auto" style="width: 100%;" >
                    <mat-label>PRODUCTO</mat-label> 
                    <input matInput type="text" [value]="product.name" name="productName" readonly />
                </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <mat-form-field floatLabel="auto" style="width: 100%;">
                    <mat-label>CANTIDAD</mat-label> 
                    <input type="number" min="1" matInput formControlName="count" [readonly]="action == 'delete'" />
                    <mat-error *ngFor="let validation of productValidationMessages.count">
                        <mat-error
                            class="error-message"
                            *ngIf="
                            productForm.get('count').hasError(validation.type) &&
                            (productForm.get('count').dirty ||
                            productForm.get('count').touched)
                            "
                            >{{ validation.message }}
                        </mat-error>
                    </mat-error>
                </mat-form-field>
            </div>

        </div>
        
        <div *ngIf="action == 'create'" class="d-flex justify-content-center">
            <button
              class="d-flex justify-content-center"
              color="primary"
              mat-raised-button
              type="submit"
              [disabled]="productForm.invalid"
            >
            AGREGAR PRODUCTO
            </button>
        </div>

        <div *ngIf="action == 'edit'" class="d-flex justify-content-center">
            <button
              class="d-flex justify-content-center"
              color="primary"
              mat-raised-button
              type="submit"
              [disabled]="productForm.invalid"
            >
              EDITAR PRODUCTO
            </button>
        </div>

        <div *ngIf="action == 'delete'" class="d-flex justify-content-center">
            <button style="background-color: #d50000 !important;"
              class="d-flex justify-content-center"
              color="primary"
              mat-raised-button
              type="submit"
              [disabled]="productForm.invalid"
            >
              BORRAR PRODUCTO
            </button>
        </div>

    </form>

    <div *ngIf="action == 'cancel'" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <p style="font-size: 18px; font-weight: 500 !important;" >Estás seguro que querés cancelar la factura?</p> 
    </div>

    <div *ngIf="action == 'cancel'" class="d-flex justify-content-center">
        <button style="background-color: #d50000 !important; margin-top: 16px; margin-bottom: 16px;"
          class="d-flex justify-content-center"
          color="primary"
          mat-raised-button
          (click)="cancelInvoice()"
        >
          CANCELAR FACTURA
        </button>
    </div>

</div>

<style>
    .container {
        position: relative;
        border: 5px solid var(--primary);
        border-radius: 10px;
        color: var(--primary);
        overflow: hidden;
    }
    .container::-webkit-scrollbar {
        width: 5px;
    }
    .container::-webkit-scrollbar-thumb {
        background: grey;
        border-radius: 10px;
        height: 10px;
    }
    .container::-webkit-scrollbar-track {
        width: 2px;
    }
    .container-h1 {
        text-align: center;
        font-size: 24px;
        font-weight: 600 !important;
        color: var(--primary);
        margin-bottom: 8px;
    }
    .container-h2 {
        text-align: center;
        font-size: 26px;
        font-weight: 700 !important;
        color: black
    }
    .container-button{
        position: absolute;
        border: none;
        color: #ffffff;
        background-color: var(--primary);
        right: 0px;
        top:0px;
    }

    ::ng-deep .mat-horizontal-stepper-header:not([ng-reflect-active="true"]) {
        pointer-events: none !important;
    }

    ::ng-deep .mat-input-element {
        border-color: var(--primary);
    }

    ::ng-deep .mat-form-field-outline-start {
        border-color: var(--primary);
    }
    ::ng-deep .mat-form-field-appearance-outline .mat-form-field-outline-end {
        border-color: var(--primary);
    }
    ::ng-deep .mat.label {
        display: none;
    }
    .section-title {
        margin-bottom: 20px;
    }
    .addButton {
        display: flex;
        justify-content: flex-end;
    }
    .user-details-container {
        padding: 20px;
        text-align: center;
    }
    .full-width {
     width: 100%;
    }
    .error-message {
        font-size: 12px;
    }
    .submit-btn {
        margin-bottom: 16px;
        width: 100%;
    }
    .award-image-popup-container {
        background-color: var(--secondary);
        margin: 56px 4px 16px 4px;
    }
    .award-image-popup {
        width: 250px;
        height: auto;
        object-fit: scale-down;
    }
    .awards-popup-button-container {
        width: 100%;
        margin: 16px 0 40px 0;
    }
    .awards-popup-button {
        background-color: var(--primary);
        color: #fff;
        font-size: 16px;
        border: solid;
        border-radius: 32px;
        width: 180px;
        height: 48px;
        text-wrap: nowrap;
        pointer-events: auto;
        cursor: pointer;
    }
    .awards-popup-button:hover {
        background-color: var(--secondary);
    }
    .award-textarea {
        width: 100%;
        margin-left: 16px;
        border: none;
        font-weight: 400 !important;
        scrollbar-width: thin;
    }
</style>
